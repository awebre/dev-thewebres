<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Hi! I&#39;m Austin Webre, and this is my dev blog."><meta name="generator" content="Eleventy v1.0.2"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><title>Le Potato Hosts Homebridge: Part 1</title><link rel="stylesheet" href="/site.css"></head><body class="font-sans leading-normal tracking-normal text-gray-900"><div class="m-20"><h3 class="text-lg font-semibold"><a class="text-teal-500 hover:text-teal-600 hover:underline" href="/">dev.thewebres.com</a></h3><article class="mt-4"><h1 class="text-3xl font-bold">Le Potato Hosts Homebridge: Part 1</h1><div class="flex justify-between"><p class="text-sm italic text-gray-400">From potato to Apple-friendly smart home bridge</p><p class="text-sm text-gray-400">3/4/2023, 3:14:00 PM CST</p></div><hr class="mt-2 mb-8"><section><h3 class="text-lg font-bold">What are potatoes good for?</h3><br><p>My original intention when buying a Le Potato SBC from Libre Computer was to host my own Mastodon instance. After having run one briefly on a very small Linode server, I realized that the headache would likely end up being too much. I did have some fun poking around at Mastodon's tech stack, but ultimately decided it just wasn't worth it.</p><br><p>So that left me with this little SBC that was just nibbling up electricity and wasting CPU cycles. And that's when I ran across someone talking about <a class="text-teal-500 hover:text-teal-600 hover:underline" href="https://homebridge.io/">Homebridge</a> which seeks to make non-HomeKit compatible devices work with HomeKit. I have generally been resistant to the smart home trend, but ever so slowly "smart" devices have been creeping their way into my home. Over time, we ended up with 3 different "smart device providers" in our home: Vivint, Kasa, and HomeKit.</p><br><p>As many of you who have gone through your own smart home journey can attest, it can be incredibly frustrating trying to remember which app is used for which devices and what types of "automation" are supported for each device/automation software. It's a mess, so I did my research and found that plugins existed for both Kasa and Vivint products.</p><br><p>Le Potato has a purpose once again.</p></section><br><section><h3 class="text-lg font-bold">Setting Up Homebridge</h3><br><aside class="text-sm italic text-gray-500">Note: I am writing this article mainly because this is my fourth time installing and setting up Homebridge. We have a notoriously bad power grid, which has led to Le Potato being corrupted on multiple occasions. If anyone has any ideas on how to make one of these SBC's less flaky after power loss, I'm all ears.</aside><br><p>I recently changed Le Potato to run Raspbian, so we'll start by following the install directions for Raspbian that I found <a class="text-teal-500 hover:text-teal-600 hover:underline" href="https://github.com/homebridge/homebridge/wiki/Install-Homebridge-on-Raspbian">here</a>. I'll list the steps out below just in case that link dies.</p><p>First, we'll need to add the Homebridge Repository and it's GPG key:</p><code class="text-white bg-black p-0.5">curl -sSfL https://repo.homebridge.io/KEY.gpg | sudo gpg --dearmor | sudo tee /usr/share/keyrings/homebridge.gpg > /dev/null</code><br><br><code class="text-white bg-black p-0.5">echo "deb [signed-by=/usr/share/keyrings/homebridge.gpg] https://repo.homebridge.io stable main" | sudo tee /etc/apt/sources.list.d/homebridge.list > /dev/null</code><br><br><p>Then we'll need to update our packages and install homebridge:</p><code class="text-white bg-black p-0.5">sudo apt-get update && sudo apt-get install homebridge</code><br><br><p>And just like that, Homebridge should be running. In order to get to the UI, we'll need to find out our public IP Address (using a command such as <code class="text-white bg-black p-0.5">ifconfig</code>). From there it's just navigating to http://your-ip-adddress:8581 and following the setup UI.</p><img src="/img/2023/3/4/homebridge-get-started.png" alt="A screenshot of the Homebridge 'Get Started' UI, with the Homebridge logo in the middle and a 'Get Started' button."><br><p>You'll enter a username and password for your admin account and then go to the dashboard, where you'll see something like this.</p><img src="/img/2023/3/4/homebridge-dash.png" alt="A screenshot of the Homebridge dashboard, which shows CPU load, memory, uptime and logs. To the left a QR code for joining your Homebridge to HomeKit has been redacted."><br><p>You can scan the QR Code in the top left, which has been redacted here, to join the Homebridge to your Home in HomeKit. Once you are through pairing the bridge, you can begin installing plugins for the various devices that you have.</p></section><section><h3 class="text-lg font-bold">Adding Kasa Devices</h3><br><p>To start adding Kasa Devices, you'll need to go to the "Plugins" page and search for "Kasa" or "tplink". You're looking for the "Homebridge Tplink Smarthome" plugin. Once you've found it, click "Install".</p><img src="/img/2023/3/4/homebridge-plugin-search.png" alt="A screenshot of the Homebridge plugin search."><br><p>Give your Kasa plugin a name, I'm going with the ever-descriptive "Kasa".</p><img src="/img/2023/3/4/homebridge-name-kasa.png" alt="A screenshot of the Kasa plugin configuration, with the word 'Kasa' entered into the 'Name' input."><br><p>Then you can choose whether to run your Kasa plugin as a "child" bridge. This is supposed to improve responsiveness and performance, so I've decided to enable that option. Note that if you do select to run it as a child bridge, you will need to hit the "restart" button in the top right of the Homebridge UI.</p><img src="/img/2023/3/4/homebridge-kasa-child.png" alt="A screenshot of the Kasa plugin configuration with the 'Child Bridge' option enabled. There is a warning that the Homebridge server will need to be restarted if this option remains enabled."><br><p>Since this is running as a child bridge, we'll need to add it to our Home separately. After the Homebridge server restarts, you'll go back to "Plugins" and find the "Connect to HomeKit" button shown below.</p><img src="/img/2023/3/4/homebridge-kasa-connect.png" alt="A screenshot of the Kasa plugin card, with the 'Connect to HomeKit' button hovered."><br><p>That should bring up this modal, with another joining QR code.</p><img src="/img/2023/3/4/homebridge-kasa-connect2.png" alt="A screenshot of the Kasa plugin configuration, with the word 'Kasa' entered into the 'Name' input."><br><p>This plugin will automatically detect Kasa devices on your network and walk you through adding each of them to HomeKit, so that they show up in the correct rooms with the correct names. Once you've run out of prompts to add new devices, you're all done and all of your Kasa devices should be added.</p></section><br><section><h3 class="text-lg font-bold">What's up next?</h3><br><p>I still need to get the Vivint home security devices configured again, but this is a decent place to stop for now. All of the smart plugs that we had in the house are now talking to HomeKit, which means phrases like "Hey Siri, turn the candle warmer off" will work again! üòÅ</p></section></article><footer><div class="flex mt-16"><a class="mr-2" href="https://github.com/awebre"><svg class="h-12" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg> </a><a rel="me" href="https://poboy.social/@riverrat"><svg class="h-12" viewBox="0 0 16 16"><path d="M 15.659 9.592 C 15.424 10.72 13.553 11.956 11.404 12.195 C 10.283 12.32 9.18 12.434 8.003 12.384 C 6.079 12.302 4.56 11.956 4.56 11.956 C 4.56 12.13 4.572 12.297 4.595 12.452 C 4.845 14.224 6.478 14.33 8.025 14.379 C 9.586 14.429 10.976 14.02 10.976 14.02 L 11.04 15.337 C 11.04 15.337 9.948 15.884 8.003 15.984 C 6.93 16.039 5.598 15.959 4.047 15.576 C 0.683 14.746 0.104 11.4 0.015 8.006 C -0.012 6.998 0.005 6.048 0.005 5.253 C 0.005 1.782 2.443 0.765 2.443 0.765 C 3.672 0.238 5.782 0.017 7.975 0 L 8.029 0 C 10.221 0.017 12.332 0.238 13.561 0.765 C 13.561 0.765 15.999 1.782 15.999 5.253 C 15.999 5.253 16.03 7.814 15.659 9.592 Z M 13.124 5.522 L 13.124 9.725 L 11.339 9.725 L 11.339 5.646 C 11.339 4.786 10.951 4.35 10.175 4.35 C 9.317 4.35 8.887 4.867 8.887 5.891 L 8.887 8.124 L 7.113 8.124 L 7.113 5.891 C 7.113 4.867 6.683 4.35 5.825 4.35 C 5.049 4.35 4.661 4.786 4.661 5.646 L 4.661 9.725 L 2.876 9.725 L 2.876 5.522 C 2.876 4.663 3.111 3.981 3.582 3.476 C 4.067 2.971 4.703 2.712 5.493 2.712 C 6.406 2.712 7.098 3.039 7.555 3.695 L 8 4.39 L 8.445 3.695 C 8.902 3.039 9.594 2.712 10.507 2.712 C 11.297 2.712 11.933 2.971 12.418 3.476 C 12.889 3.981 13.124 4.663 13.124 5.522 Z" style="stroke:none;stroke-miterlimit:10;fill-rule:evenodd;"/></svg></a></div></footer></div></body></html>